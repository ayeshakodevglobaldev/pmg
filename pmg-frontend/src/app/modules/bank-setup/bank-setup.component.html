<div class="bank-setup">
  <h2>Bank Setup</h2>

  <form [formGroup]="bankForm" (ngSubmit)="submitBank()">
    <!-- Bank Info -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="flex-item">
        <mat-label>Bank Name</mat-label>
        <input matInput formControlName="bankName" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="flex-item">
        <mat-label>Bank ID (BIC/SBP)</mat-label>
        <input matInput formControlName="bankId" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="flex-full">
        <mat-label>Certificate</mat-label>
        <input
          matInput
          readonly
          [value]="bankForm.get('certificate')?.value?.name || ''"
        />
        <button
          mat-icon-button
          matSuffix
          (click)="fileInput.click()"
          aria-label="Upload Certificate"
        >
          <mat-icon>attach_file</mat-icon>
        </button>
        <input
          hidden
          type="file"
          #fileInput
          (change)="onCertificateChange($event)"
        />
      </mat-form-field>
    </div>

    

    <!-- Channels -->
    <h3>Channel Configurations</h3>
    <button
    class="add-channgel-button"
      mat-raised-button
      color="accent"
      type="button"
      (click)="addChannel()"
    >
      Add Channel
    </button>

    <div formArrayName="channels" class="channel-list">
      <div
        *ngFor="let channel of channels.controls; let i = index"
        [formGroupName]="i"
        class="channel-config"
      >
        <mat-card class="channel-card">
          <mat-card-header>
            <mat-card-title>{{
              channel.get("name")?.value || "New Channel"
            }}</mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <mat-slide-toggle formControlName="enabled"
              >Enabled</mat-slide-toggle
            >

            <div class="form-row">
              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Channel Name</mat-label>
                <mat-select formControlName="name">
                  <mat-option value="MT">MT</mat-option>
                  <mat-option value="MX">MX</mat-option>
                  <mat-option value="RTGS">RTGS</mat-option>
                  <mat-option value="RAAST">Raast</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Format</mat-label>
                <mat-select formControlName="format">
                  <mat-option value="MT">MT</mat-option>
                  <mat-option value="MX">MX</mat-option>
                  <mat-option value="RTGS">RTGS</mat-option>
                  <mat-option value="RAAST">Raast</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Input Path</mat-label>
                <input matInput formControlName="inputPath" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Output Path / API</mat-label>
                <input matInput formControlName="outputPath" />
              </mat-form-field>
            </div>

            <!-- Credentials -->
            <h4>Credentials</h4>
            <div formGroupName="credentials" class="form-row">
              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Username</mat-label>
                <input matInput formControlName="username" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Password</mat-label>
                <input matInput type="password" formControlName="password" />
              </mat-form-field>
            </div>

            <!-- Certificate upload -->
            <div class="file-upload">
              <button
                mat-stroked-button
                color="primary"
                type="button"
                (click)="channelFileInput.click()"
              >
                Upload Certificate
              </button>
              <input
                hidden
                type="file"
                #channelFileInput
                (change)="
                  channel
                    .get('credentials.certificate')
                    ?.setValue($event.target)
                "
              />
              <span *ngIf="channel.get('credentials.certificate')?.value">
                {{ channel.get("credentials.certificate")?.value?.name }}
              </span>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <button
              mat-button
              color="warn"
              type="button"
              (click)="removeChannel(i)"
            >
              Remove Channel
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- Logs -->
    <h3>Logs & Reports</h3>
    <div formGroupName="logs" class="form-row">
      <mat-form-field appearance="outline" class="flex-item">
        <mat-label>Logs Path</mat-label>
        <input matInput formControlName="logPath" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="flex-item">
        <mat-label>Reports Path</mat-label>
        <input matInput formControlName="reportPath" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="flex-item">
        <mat-label>Retention (days)</mat-label>
        <input matInput type="number" formControlName="retention" />
      </mat-form-field>
    </div>

    <!-- Buttons -->
    <div class="actions">
      <button mat-raised-button color="primary" type="submit">Save</button>
      <button mat-button type="reset" (click)="resetForm()">Reset</button>
    </div>
  </form>
</div>
